<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Weather Dashboard</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
      }

      .search-box {
        background: white;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
      }

      .search-box input {
        width: 70%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
      }

      .search-box button {
        width: 28%;
        padding: 12px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        margin-left: 2%;
      }

      .weather-card {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        margin-bottom: 20px;
      }

      .current-weather {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .temp-display {
        font-size: 60px;
        font-weight: bold;
      }

      .forecast-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .forecast-item {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
      }

      .loading {
        text-align: center;
        padding: 40px;
        font-size: 18px;
        color: white;
      }

      .error {
        background: #dc3545;
        color: white;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .recent-searches {
        display: flex;
        gap: 10px;
        margin-top: 10px;
        flex-wrap: wrap;
      }

      .recent-city {
        padding: 5px 15px;
        background: #e9ecef;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
      }

      .recent-city:hover {
        background: #dee2e6;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 style="color: white; text-align: center; margin-bottom: 30px">
        Weather Dashboard
      </h1>

      <div class="search-box">
        <input
          type="text"
          id="cityInput"
          placeholder="Enter city name..."
          onkeypress="if(event.key==='Enter') searchWeather()"
        />
        <button onclick="searchWeather()">Search</button>
        <div class="recent-searches" id="recentSearches"></div>
      </div>

      <div id="errorMessage"></div>
      <div id="weatherDisplay"></div>
      <div id="forecastDisplay"></div>
    </div>

    <script>
      const API_KEY = "2d74685677be2867941733da6f0ecf5e"; // Replace with your OpenWeatherMap API key
      const BASE_URL = "https://api.openweathermap.org/data/2.5";

      const weatherDisplay = document.getElementById("weatherDisplay");
      const forecastDisplay = document.getElementById("forecastDisplay");
      const errorMessage = document.getElementById("errorMessage");
      const recentSearchesDiv = document.getElementById("recentSearches");

      // condition based on forecast data => data.weather.main
      function getWeatherIcon(condition) {
        const icons = {
          Clear: "‚òÄÔ∏è",
          Clouds: "‚òÅÔ∏è",
          Rain: "üåßÔ∏è",
          Snow: "‚ùÑÔ∏è",
          Thunderstorm: "‚õàÔ∏è",
          Drizzle: "üå¶Ô∏è",
          Mist: "üå´Ô∏è",
        };
        return icons[condition] || "‚òÅÔ∏è";
      }

      async function fetchWeather(city) {
        // TODO: Fetch current weather from API
        const url = `${BASE_URL}/weather?q=${city}&appid=${API_KEY}&units=metric`;
        const res = await fetch(url);
        if (!res.ok) throw new Error("City not found");
        return res.json();
      }

      async function fetchForecast(city) {
        // TODO: Fetch 5-day forecast from API
        const url = `${BASE_URL}/forecast?q=${city}&appid=${API_KEY}&units=metric`;
        const res = await fetch(url);
        if (!res.ok) throw new Error("City not found");
        return res.json();
      }

      function displayWeather(data) {
        // TODO: Display current weather
        // data.main.temp, data.weather[0].description
        // data.main.humidity, data.wind.speed
        const icon = getWeatherIcon(data.weather[0].main);
        weatherDisplay.innerHTML = `
                <div class="weather-card">
                    <div class="current-weather">
                        <div>
                            <h2>${data.name}, ${data.sys.country}</h2>
                            <p>${data.weather[0].description} ${icon}</p>
                        </div>
                        <div class="temp-display">${Math.round(
                          data.main.temp
                        )}¬∞C</div>
                    </div>
                    <p>Humidity: ${
                      data.main.humidity
                    }% &nbsp;&nbsp; Wind: ${Math.round(
          data.wind.speed
        )} km/h</p>
                </div>
            `;
      }

      function displayForecast(data) {
        // TODO: Display forecast (filter for one per day)
        // filter to only 1 forecast per day
        const noonForecasts = data.list.filter((item) =>
          item.dt_txt.includes("12:00:00")
        );
        let html = `
                <h2 style="color: white; margin-top: 20px;">5-Day Forecast</h2>
                <div class="forecast-grid">
            `;
        noonForecasts.forEach((forecast) => {
          const date = new Date(forecast.dt_txt);
          const day = date.toLocaleDateString("en-US", { weekday: "short" });
          const icon = getWeatherIcon(forecast.weather[0].main);
          html += `
                    <div class="forecast-item">
                        <h4>${day}</h4>
                        <div style="font-size: 30px;">${icon}</div>
                        <p>${Math.round(forecast.main.temp)}¬∞C</p>
                    </div>
                `;
        });
        html += "</div>";
        forecastDisplay.innerHTML = html;
      }

      async function searchWeather() {
        // TODO: Get city input and fetch weather
        // TODO: Handle loading state
        // TODO: Handle errors
        // TODO: Save to recent searches
        const city = document.getElementById("cityInput").value.trim();
        if (!city) return;
        weatherDisplay.innerHTML = `<div class="loading">Loading weather...</div>`;
        forecastDisplay.innerHTML = "";

        try {
          clearError();
          const weatherData = await fetchWeather(city);
          const forecastData = await fetchForecast(city);
          displayWeather(weatherData);
          displayForecast(forecastData);
          saveRecentSearch(city);
          loadRecentSearches();
        } catch (error) {
          showError(error.message);
        }
      }

      function saveRecentSearch(city) {
        // TODO: Save to localStorage (max 5 cities)
        let searches = JSON.parse(localStorage.getItem("recentSearches")) || [];
        if (!searches.includes(city)) {
          searches.unshift(city);
          if (searches.length > 5) searches.pop();
          localStorage.setItem("recentSearches", JSON.stringify(searches));
        }
      }

      function loadRecentSearches() {
        // TODO: Load and display recent searches
        const searches =
          JSON.parse(localStorage.getItem("recentSearches")) || [];
        recentSearchesDiv.innerHTML = searches
          .map(
            (city) =>
              `<div class="recent-city" onclick="document.getElementById('cityInput').value='${city}'; searchWeather();">${city}</div>`
          )
          .join("");
      }

      function showError(message) {
        // TODO: Display error message
        errorMessage.innerHTML = `<div class="error">${message}</div>`;
      }

      function clearError() {
        // TODO: Clear error message
        errorMessage.innerHTML = "";
      }

      // Initialize searches on page load
      loadRecentSearches();
    </script>
  </body>
</html>
